# âœ… å‰ç«¯ä»£ç¢¼æ›´æ–°è¨˜éŒ„ - å¾ Google Sheets é·ç§»åˆ° Supabase

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025å¹´1æœˆï¼ˆå…·é«”æ—¥æœŸè«‹è£œå……ï¼‰

## ğŸ¯ æ›´æ–°ç›®æ¨™
å°‡å‰ç«¯ä»£ç¢¼å¾ä½¿ç”¨ Google Sheets API å®Œå…¨åˆ‡æ›åˆ° Supabase API

## âœ… å·²å®Œæˆçš„æ›´æ–°

### 1. HTML æª”æ¡ˆæ›´æ–°

#### `index.html`
- âœ… æ·»åŠ  Supabase JS åº«å¼•ç”¨
  ```html
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  ```

#### `admin.html`
- âœ… æ·»åŠ  Supabase JS åº«å¼•ç”¨
  ```html
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  ```

### 2. `script.js` æ›´æ–°

#### é…ç½®æ›´æ–°
- âœ… ç§»é™¤ `GOOGLE_SHEETS_CONFIG`
- âœ… æ–°å¢ `SUPABASE_CONFIG`
  ```javascript
  const SUPABASE_CONFIG = {
    url: 'https://sqgrnowrcvspxhuudrqc.supabase.co',
    anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
    enabled: true
  };
  ```
- âœ… åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯
  ```javascript
  let supabaseClient;
  if (typeof window.supabase !== 'undefined') {
    supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
  }
  ```

#### å‡½æ•¸æ›´æ–°

##### `fetchBookingsFromGoogleSheets()` â†’ ä½¿ç”¨ Supabase
- âœ… å¾ Supabase è®€å–æ‰€æœ‰é ç´„è³‡æ–™
- âœ… è½‰æ›è³‡æ–™æ ¼å¼ï¼ˆç¬¦åˆåŸæœ‰çµæ§‹ï¼‰
- âœ… ä¿æŒå‘å¾Œå…¼å®¹ï¼ˆä½¿ç”¨ `rowNumber` æ˜ å°„åˆ° `id`ï¼‰

##### `fetchBookedDatesFromSheets()` â†’ ä½¿ç”¨ Supabase
- âœ… å¾ Supabase è®€å–å·²é ç´„æ—¥æœŸ
- âœ… è½‰æ›ç‚ºåŸæœ‰æ ¼å¼
- âœ… æ”¯æ´æ—¥æœŸæ ¼å¼è§£æ

##### `submitToGoogleSheets()` â†’ ä½¿ç”¨ Supabase
- âœ… æ–°å¢é ç´„ï¼šä½¿ç”¨ `supabase.from('foodcarcalss').insert()`
- âœ… æ¥æ‰‹é ç´„ï¼šä½¿ç”¨ `supabase.from('foodcarcalss').update().eq('id', ...)`
- âœ… æ’ç­é‡‹å‡ºï¼šä½¿ç”¨ `supabase.from('foodcarcalss').update().eq('id', ...)`
- âœ… åˆªé™¤é ç´„ï¼šä½¿ç”¨ `supabase.from('foodcarcalss').delete().eq('id', ...)`
- âœ… æ›´æ–°ä»˜æ¬¾ç‹€æ…‹ï¼šä½¿ç”¨ `supabase.from('foodcarcalss').update().eq('id', ...)`

##### `startSheetsSyncInterval()` â†’ ä½¿ç”¨ Supabase
- âœ… æ›´æ–°ç‚ºä½¿ç”¨ Supabase åŒæ­¥
- âœ… ä¿æŒ 30 ç§’åŒæ­¥é–“éš”

##### `syncGoogleSheets()` â†’ ä½¿ç”¨ Supabase
- âœ… æ›´æ–°å‡½æ•¸åç¨±å’Œæ—¥èªŒè¨Šæ¯
- âœ… ä½¿ç”¨ Supabase API åŒæ­¥

##### `startPeriodicSync()` â†’ ä½¿ç”¨ Supabase
- âœ… æ›´æ–°æ—¥èªŒè¨Šæ¯

### 3. `admin.js` æ›´æ–°

#### é…ç½®æ›´æ–°
- âœ… ç§»é™¤ `API_URL`ï¼ˆGoogle Sheets URLï¼‰
- âœ… æ–°å¢ Supabase é…ç½®
  ```javascript
  const SUPABASE_URL = 'https://sqgrnowrcvspxhuudrqc.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
  ```
- âœ… åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯
  ```javascript
  let supabaseClientInstance;
  if (typeof window.supabase !== 'undefined') {
    supabaseClientInstance = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  }
  ```

#### å‡½æ•¸æ›´æ–°

##### `loadBookings()` â†’ ä½¿ç”¨ Supabase
- âœ… å¾ Supabase è®€å–æ‰€æœ‰é ç´„
- âœ… è½‰æ›è³‡æ–™æ ¼å¼
- âœ… ä¿æŒå‘å¾Œå…¼å®¹

##### `saveBooking()` â†’ ä½¿ç”¨ Supabase
- âœ… ä½¿ç”¨ `supabase.from('foodcarcalss').update().eq('id', ...)`
- âœ… æ ¼å¼åŒ–æ—¥æœŸç‚ºã€Œ10æœˆ13æ—¥(æ˜ŸæœŸä¸€)ã€æ ¼å¼
- âœ… æ›´æ–°æ‰€æœ‰æ¬„ä½

##### `deleteBooking()` â†’ ä½¿ç”¨ Supabase
- âœ… ä½¿ç”¨ `supabase.from('foodcarcalss').delete().eq('id', ...)`

##### `executePaymentStatusChange()` â†’ ä½¿ç”¨ Supabase
- âœ… ä½¿ç”¨ `supabase.from('foodcarcalss').update().eq('id', ...)`
- âœ… åªæ›´æ–°ä»˜æ¬¾ç‹€æ…‹æ¬„ä½

## ğŸ”„ è³‡æ–™æ ¼å¼è½‰æ›

### Supabase â†’ å‰ç«¯æ ¼å¼
```javascript
{
  id: row.id,                    // Supabase ä¸»éµ
  rowNumber: row.id,             // å‘å¾Œå…¼å®¹ï¼ˆæ˜ å°„åˆ° rowNumberï¼‰
  timestamp: row.timestamp,
  vendor: row.vendor,
  foodType: row.food_type,       // è½‰æ›æ¬„ä½åç¨±
  location: row.location,
  date: row.booking_date,       // è½‰æ›æ¬„ä½åç¨±
  status: row.status,
  bookedStatus: row.status,
  fee: row.fee,
  payment: row.payment,
  note: row.note
}
```

### å‰ç«¯ â†’ Supabase æ ¼å¼
```javascript
{
  timestamp: formData.timestamp,
  vendor: formData.vendor,
  food_type: formData.foodType,      // è½‰æ›æ¬„ä½åç¨±
  location: formData.location,
  booking_date: formatDateForDisplay(formData.date),  // è½‰æ›æ¬„ä½åç¨±å’Œæ ¼å¼
  status: 'å·±æ’',
  fee: formData.fee || '600å…ƒ/å¤©',
  payment: 'å°šæœªä»˜æ¬¾',
  note: ''
}
```

## ğŸ“‹ åŠŸèƒ½å°ç…§è¡¨

| åŠŸèƒ½ | Google Sheets | Supabase |
|------|--------------|----------|
| è®€å–æ‰€æœ‰é ç´„ | `GET ?action=getBookings` | `supabase.from('foodcarcalss').select()` |
| è®€å–å·²é ç´„æ—¥æœŸ | `GET ?action=getBookedDates` | `supabase.from('foodcarcalss').select('location, booking_date')` |
| æ–°å¢é ç´„ | `POST` with formData | `supabase.from('foodcarcalss').insert()` |
| æ›´æ–°é ç´„ | `POST` with action=updateBooking | `supabase.from('foodcarcalss').update().eq('id', ...)` |
| åˆªé™¤é ç´„ | `POST` with action=delete | `supabase.from('foodcarcalss').delete().eq('id', ...)` |
| æ›´æ–°ä»˜æ¬¾ç‹€æ…‹ | `POST` with action=updatePayment | `supabase.from('foodcarcalss').update().eq('id', ...)` |
| æ¥æ‰‹é ç´„ | `POST` with action=takeover | `supabase.from('foodcarcalss').update().eq('id', ...)` |
| æ’ç­é‡‹å‡º | `POST` with action=transfer | `supabase.from('foodcarcalss').update().eq('id', ...)` |

## âš ï¸ é‡è¦è®Šæ›´

### 1. è¡Œè™Ÿç³»çµ±
- **èˆŠç³»çµ±**: ä½¿ç”¨ Google Sheets è¡Œè™Ÿï¼ˆ`rowNumber`ï¼‰
- **æ–°ç³»çµ±**: ä½¿ç”¨ Supabase IDï¼ˆ`id`ï¼‰
- **å…¼å®¹æ€§**: ä»£ç¢¼ä¸­ä»ä½¿ç”¨ `rowNumber`ï¼Œä½†å¯¦éš›æ˜ å°„åˆ° Supabase çš„ `id`

### 2. æ—¥æœŸæ ¼å¼
- **å„²å­˜æ ¼å¼**: Supabase ä¸­å„²å­˜ç‚ºã€Œ10æœˆ13æ—¥(æ˜ŸæœŸä¸€)ã€æ ¼å¼ï¼ˆèˆ‡ Google Sheets ç›¸åŒï¼‰
- **è¼¸å…¥æ ¼å¼**: å‰ç«¯è¼¸å…¥ ISO æ ¼å¼ï¼ˆ`2025-10-13`ï¼‰ï¼Œè‡ªå‹•è½‰æ›ç‚ºé¡¯ç¤ºæ ¼å¼

### 3. ä»˜æ¬¾ç‹€æ…‹
- **åˆå§‹ç‹€æ…‹**: æ–°å¢é ç´„æ™‚è¨­ç‚ºã€Œå°šæœªä»˜æ¬¾ã€
- **ç‹€æ…‹å€¼**: èˆ‡ Google Sheets ä¿æŒä¸€è‡´ï¼ˆã€Œå°šæœªä»˜æ¬¾ã€ã€ã€Œå·±ç¹³æ¬¾ã€ã€ã€Œé€¾ç¹³å¯æ’ã€ï¼‰

## ğŸ§ª æ¸¬è©¦é …ç›®

### å‰ç«¯åŠŸèƒ½æ¸¬è©¦
- [ ] è¼‰å…¥é ç´„åˆ—è¡¨
- [ ] æ–°å¢é ç´„
- [ ] ç·¨è¼¯é ç´„
- [ ] åˆªé™¤é ç´„
- [ ] æ›´æ–°ä»˜æ¬¾ç‹€æ…‹
- [ ] æ¥æ‰‹é€¾æœŸé ç´„
- [ ] æ’ç­é‡‹å‡º
- [ ] æ—¥æœŸç¯©é¸
- [ ] æœˆä»½é¸æ“‡
- [ ] æœå°‹åŠŸèƒ½

### å¾Œå°åŠŸèƒ½æ¸¬è©¦
- [ ] è¼‰å…¥é ç´„åˆ—è¡¨
- [ ] ç·¨è¼¯é ç´„
- [ ] åˆªé™¤é ç´„
- [ ] å¿«é€Ÿè®Šæ›´ä»˜æ¬¾ç‹€æ…‹
- [ ] æœˆä»½ç¯©é¸
- [ ] æ—¥æœŸæ’åº
- [ ] çµ±è¨ˆè³‡è¨Š

## ğŸ“ æ³¨æ„äº‹é …

1. **å‘å¾Œå…¼å®¹**: ä»£ç¢¼ä¸­ä»ä½¿ç”¨ `rowNumber` è®Šæ•¸åï¼Œä½†å¯¦éš›æ˜ å°„åˆ° Supabase çš„ `id`
2. **æ—¥æœŸæ ¼å¼**: ç¢ºä¿æ—¥æœŸæ ¼å¼åŒ–å‡½æ•¸æ­£ç¢ºè™•ç†å„ç¨®è¼¸å…¥æ ¼å¼
3. **éŒ¯èª¤è™•ç†**: æ‰€æœ‰ Supabase æ“ä½œéƒ½åŒ…å«éŒ¯èª¤è™•ç†
4. **åŒæ­¥æ©Ÿåˆ¶**: ä¿æŒ 30 ç§’è‡ªå‹•åŒæ­¥é–“éš”

## âœ… æ›´æ–°å®Œæˆç‹€æ…‹

- [x] HTML æª”æ¡ˆæ›´æ–°
- [x] `script.js` æ ¸å¿ƒåŠŸèƒ½æ›´æ–°
- [x] `admin.js` æ ¸å¿ƒåŠŸèƒ½æ›´æ–°
- [x] è³‡æ–™æ ¼å¼è½‰æ›
- [x] éŒ¯èª¤è™•ç†
- [ ] åŠŸèƒ½æ¸¬è©¦ï¼ˆå¾…åŸ·è¡Œï¼‰

---

**æ›´æ–°å®Œæˆæ™‚é–“**: ï¼ˆè«‹è£œå……ï¼‰
**æ›´æ–°äººå“¡**: ï¼ˆè«‹è£œå……ï¼‰
**å‚™è¨»**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²æ›´æ–°ç‚ºä½¿ç”¨ Supabase API
