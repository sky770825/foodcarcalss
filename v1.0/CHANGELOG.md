# 📝 版本更新日誌

所有重要的專案變更都會記錄在此文件中。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，
版本號遵循 [Semantic Versioning](https://semver.org/lang/zh-TW/)。

---

## [3.1.0] - 2025-10-11

### 新增 ✨
- 🔢 中文日期智能排序系統
  - 新增 `parseChineseDateToNumber()` 函數
  - 支援「12月12日(星期一)」格式解析
  - 轉換為數字後正確排序（1月→12月）
  
- ⚡ 快速排序功能
  - 新增 `quickSortSheet()` 輔助函數
  - 所有操作後自動觸發排序
  - 排序後顯示前5筆資料供確認

### 變更 🔄
- 📊 更新所有排序函數使用中文日期邏輯
  - `addBookingToSheet()` 新增後自動排序
  - `takeoverBooking()` 接手後自動排序
  - `transferBooking()` 轉讓後自動排序
  - `deleteBooking()` 刪除後自動排序
  - `getAllBookings()` 載入前自動排序
  - `getBookedDates()` 讀取前自動排序

### 優化 ⚡
- 📈 排序效能提升
  - 使用 JavaScript 原生 `sort()` 方法
  - 避免多次讀寫工作表
  - 減少 API 呼叫次數

### 修復 🐛
- ✅ 修正「10月」排在「2月」之後的問題
- ✅ 修正字符串排序導致日期順序錯誤

---

## [3.0.1] - 2025-10-11

### 修復 🐛
- 🔒 修復手機版輸入框聚焦時彈窗突然放大的問題
  - 移除所有 `input:focus` 的 `transform: scale()` 效果
  - 設定 `maximum-scale=1.0, user-scalable=no`
  - 手機版輸入框固定 `font-size: 16px` 防止 iOS 自動縮放

### 變更 🔄
- 📝 優化使用教學「取消預約」說明
  - 改為引導用戶聯繫官方小幫手
  - 移除自行操作取消的說明
  - 強調提供必要資訊（餐車名稱、日期、場地）

### 優化 ⚡
- 📱 手機版輸入體驗改進
  - 彈窗內容固定大小，不會因輸入而變動
  - 移除點擊高亮效果 `-webkit-tap-highlight-color: transparent`
  - 接手預約彈窗輸入框樣式統一

---

## [3.0.0] - 2025-10-11

### 新增 ✨
- ❓ 使用教學彈窗系統
  - 新增幫助按鈕（藍色圓形 ? 圖標）
  - 六大功能完整說明：
    1. 如何預約排班
    2. 付款說明
    3. 轉讓排班
    4. 取消預約
    5. 接手逾期排班
    6. 聯繫官方小幫手
  - 支援 ESC 鍵關閉

- 📊 場地費用結算表功能
  - 新增 `createOrUpdateLocationFeeSheet()` 函數
  - 自動統計各場地：
    - 總報班數、已付款數、未付款數
    - 總費用、已收費用、未收費用
    - 付款率（百分比）
  - 條件格式顏色標示：
    - 綠色：付款率 ≥80%
    - 黃色：付款率 50-79%
    - 紅色：付款率 <50%
  - 自動計算總計行

- 🗺️ 場地名稱標準化系統
  - 新增 `normalizeLocationName()` 函數
  - 支援多種格式自動轉換：
    - "四維路70號" → "漢堡大亨"
    - "楊梅區四維路70號" → "漢堡大亨"
    - "漢堡大亨 - 四維路70號" → "漢堡大亨"
  - 新增 `checkSheetsLocationNames()` 診斷工具

### 變更 🔄
- 🔧 F欄公式邏輯優化
  ```excel
  =IF(OR(H2="己繳款", H2="已付款"), "己排班", 
     IF(AND(H2="尚未付款", (NOW()-A2)*24>24), "逾繳可排", "己排班"))
  ```
  - 優先檢查付款狀態
  - 「己繳款」或「已付款」永遠顯示「己排班」
  - 只有「尚未付款」才檢查24小時時限

- 🎨 使用教學「轉讓排班」說明強化
  - 新增「系統會自動通知官方小幫手」說明
  - 明確標示會傳遞接手餐車名稱

### 優化 ⚡
- 📍 場地卡片顯示優化
  - 所有場地統一顯示地址作為主標題
  - 非戶外場地才顯示「(餐車名稱)」
  - 說明欄顯示完整注意事項

---

## [2.9.0] - 2025-10-10

### 變更 🔄
- 🎨 場地過濾按鈕布局調整
  - 手機版改為 2行3欄 grid 布局
  - 桌面版保持單行顯示
  - 按鈕支援自動換行 `white-space: normal`

- 📱 手機版彈窗優化
  - 所有彈窗寬度調整為 92%（極小屏幕 94%）
  - 最大高度設定為 88vh
  - 使用 `clamp()` 函數實現自動字體縮放
  - 銀行資訊顯示優化為橫向布局

### 優化 ⚡
- 🎯 按鈕樣式改進
  - 最小高度設定確保一致性
  - 文字居中對齊
  - 圖標和文字間距調整

---

## [2.8.0] - 2025-10-10

### 優化 ⚡
- ⚡ 載入速度優化
  - 移除初始 1 秒延遲
  - 立即開始 Google Sheets 同步
  - 減少成功/失敗訊息顯示時間
    - 成功：800ms → 600ms
    - 失敗：1500ms → 1200ms

- 📊 性能監控
  - 新增詳細計時日誌
    - `startTime`: 頁面載入開始
    - `syncStartTime`: API 呼叫開始
    - `syncEndTime`: API 呼叫結束
    - `syncDuration`: 同步耗時
    - `totalDuration`: 總耗時

---

## [2.7.0] - 2025-10-09

### 新增 ✨
- 🎊 吉祥語載入動畫
  - 財源滾滾 🧧
  - 生意興隆 🎉
  - 大發利市 💰
  - 好運連連 🌟
  - 賓客滿門 🎊
  - 客似雲來 🍜
  - 圓滿順利 ✨
  - 財運亨通 🎯
  - 萬事如意 🎉（完成時）

- ⏱️ 動態倒數計時
  - 從 5 秒開始倒數
  - 每秒更新顯示
  - 載入完成顯示「✓ 完成」

### 變更 🔄
- 💫 載入訊息系統優化
  - 支援 HTML 格式內容
  - 兩行顯示：吉祥語 + 倒數
  - 不同狀態不同樣式：
    - 載入中：白色文字
    - 成功：綠色背景
    - 失敗：紅色背景

---

## [2.6.0] - 2025-10-09

### 變更 🔄
- 🔄 完全移除本地快取機制
  - 停用 `localStorage` 儲存預約資料
  - 所有資料強制從 Google Sheets 載入
  - 移除 `loadFromLocalStorage()` 呼叫

- ☁️ 強制雲端同步
  - `mergeSheetsDataToCalendar()` 完全清空現有資料
  - 只顯示 Google Sheets 中的資料
  - 新增 `source: 'google_sheets'` 標記

### 新增 ✨
- 🔍 資料來源診斷工具
  - `checkDataSource()`: 檢查所有事件來源
  - `diagnoseAllBookings()`: 診斷預約資料
  - `clearLocalCache()`: 清除本地快取
  - `syncOnlySheetsData()`: 強制同步雲端資料

---

## [2.5.0] - 2025-10-08

### 新增 ✨
- 🎬 載入動畫系統
  - 載入遮罩 (`loading-overlay`)
  - 旋轉動畫 spinner
  - 載入訊息提示
  - 淡入效果 (`fadeIn`)

- 🌊 載入流程優化
  - 顯示「正在連接雲端資料庫...」
  - 顯示「正在載入排班資料...」
  - 成功：「✓ 載入完成！」
  - 失敗：「✗ 載入失敗，請重新整理頁面」

### 變更 🔄
- 💬 使用者體驗改進
  - 主內容初始不透明度為 0
  - 載入完成後淡入顯示
  - 載入時禁止互動

---

## [2.4.0] - 2025-10-08

### 新增 ✨
- 🗑️ 自動清除舊資料機制
  - 版本更新時清除 `localStorage`
  - 清除 `foodtruck_bookings`
  - 清除 `foodtruck_bookedSlots`
  - 重置 `allEvents` 和 `bookedSlots`

- 📦 版本控制系統
  - `SYSTEM_VERSION` 常數
  - `checkVersionAndRefresh()` 函數
  - 自動比對版本並清除快取

### 變更 🔄
- 🔄 強制重新載入資料
  - DOMContentLoaded 時清空資料
  - 禁用本地快取載入
  - 完全依賴 Google Sheets

---

## [2.3.0] - 2025-10-07

### 新增 ✨
- 📱 LINE瀏覽器特殊優化
  - 用戶代理檢測 `detectLineApp()`
  - 自動添加 `.line-browser` class
  - 強制水平文字顯示
  - 固定字體大小（0.6rem）

- 🔧 瀏覽器模式顯示
  - 頁尾顯示當前瀏覽器模式
  - 「一般模式」或「LINE瀏覽器模式」

### 變更 🔄
- 📄 快取控制 meta 標籤
  - `Cache-Control: no-cache, no-store, must-revalidate`
  - `Pragma: no-cache`
  - `Expires: 0`

---

## [2.2.0] - 2025-10-07

### 優化 ⚡
- 📅 日期數字顯示優化
  - 使用 `clamp()` 實現自動縮放
  - 桌面版：`clamp(0.75rem, 1.2vw, 0.9rem)`
  - 手機版：`clamp(0.7rem, 4vw, 0.85rem)`
  - 極小屏幕：`clamp(0.65rem, 4.5vw, 0.8rem)`

- 🏷️ 餐車名稱顯示優化
  - 使用 `clamp()` 實現自動縮放
  - 桌面版：`clamp(0.6rem, 1vw, 0.75rem)`
  - 手機版：`clamp(0.5rem, 3vw, 0.65rem)`
  - 極小屏幕：`clamp(0.45rem, 3.5vw, 0.6rem)`

---

## [2.1.0] - 2025-10-07

### 新增 ✨
- 📏 餐車名稱垂直顯示（手機版）
  - `writing-mode: vertical-rl`
  - `text-orientation: upright`
  - `letter-spacing: 0.05em`
  - 自動居中對齊

### 優化 ⚡
- 📱 手機版布局優化
  - `.event-container` 改為 `flex-direction: column`
  - `.day-events` 改為 `flex-direction: row`
  - `.cancel-btn` 位置調整
  - 最大寬度限制確保不超出

---

## [2.0.0] - 2025-10-06

### 新增 ✨
- 📱 完整響應式設計
  - 桌面版自動縮放
  - 平板版（max-width: 1024px）
  - 手機版（max-width: 768px）
  - 極小屏幕（max-width: 480px）

- 🔤 自動文字縮放
  - 付款狀態文字自動調整
  - 支援 `white-space: normal`
  - 支援 `word-break: keep-all`

### 變更 🔄
- 💳 付款狀態顯示優化
  - 自動換行而不截斷
  - 保持詞彙完整性
  - 動態調整位置和大小

---

## [1.5.0] - 2025-10-06

### 新增 ✨
- 🔐 換班密碼驗證
  - 接手預約需輸入密碼
  - 轉讓排班需輸入密碼
  - 預設密碼：`abc123`

- 📞 官方小幫手整合
  - 點擊卡片直接開啟 LINE
  - 取消預約引導聯繫客服
  - 所有客服連結統一

---

## [1.0.0] - 2025-10-05

### 新增 ✨
- 🎉 初始版本發布
- 📅 行事曆顯示系統
- 📝 預約功能
  - 快速預約
  - 完整表單預約
- 💰 付款管理
  - LINE Pay
  - ATM 轉帳
  - 現金
- 🔄 轉讓功能
- 🤝 接手功能
- 🏢 多場地支援
- 📊 Google Sheets 整合
- 🎨 美觀的 UI 設計
- 📱 基礎響應式支援

---

## 版本號說明

版本號格式：`主版本.次版本.修訂版本`

- **主版本**：重大功能更新或不相容變更
- **次版本**：新功能或功能增強
- **修訂版本**：錯誤修復和小調整

---

## 圖示說明

- ✨ 新增功能
- 🔄 變更
- ⚡ 優化
- 🐛 修復
- 🎨 樣式
- 📝 文檔
- 🔐 安全性
- 📱 移動端
- 💻 桌面端

---

<div align="center">

[返回主文檔](README.md)

</div>

