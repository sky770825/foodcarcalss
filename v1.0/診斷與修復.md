# ğŸ”§ æ–°å¢é ç´„ç„¡æ³•å¯«å…¥ Google Sheets - è¨ºæ–·èˆ‡ä¿®å¾©

## å•é¡Œç¾è±¡
âœ… Web App URL å·²è¨­å®šï¼š`https://script.google.com/macros/s/AKfycbzSw1_5Ve7WIwzziUAwKKmu3tde8DzBOxRi7ghxzmGbn10M1EtGKJARIPwVVY35-zZp/exec`

âŒ ä½†æ–°å¢é ç´„æ™‚è³‡æ–™æ²’æœ‰å¯«å…¥ Google Sheets

---

## ğŸ” è¨ºæ–·æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¸âƒ£ï¼šæª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°

1. æŒ‰ **F12** é–‹å•Ÿé–‹ç™¼è€…å·¥å…·
2. åˆ‡æ›åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** æ¨™ç±¤
3. å˜—è©¦æ–°å¢ä¸€ç­†é ç´„
4. æŸ¥çœ‹æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

**å¸¸è¦‹éŒ¯èª¤è¨Šæ¯ï¼š**
```
âŒ CORS policy blocked
âŒ 403 Forbidden
âŒ 404 Not Found
âŒ Failed to fetch
```

---

### æ­¥é©Ÿ 2ï¸âƒ£ï¼šæª¢æŸ¥ Google Apps Script éƒ¨ç½²

#### 2.1 ç¢ºèªéƒ¨ç½²è¨­å®š

1. é–‹å•Ÿ Google Apps Script ç·¨è¼¯å™¨
2. é»æ“Š **éƒ¨ç½²** â†’ **ç®¡ç†éƒ¨ç½²ä½œæ¥­**
3. ç¢ºèªè¨­å®šï¼š

```
âœ… é¡å‹ï¼šç¶²é æ‡‰ç”¨ç¨‹å¼
âœ… åŸ·è¡Œèº«åˆ†ï¼šæˆ‘
âœ… å…·æœ‰æ‡‰ç”¨ç¨‹å¼å­˜å–æ¬Šçš„ä½¿ç”¨è€…ï¼šæ‰€æœ‰äºº
âœ… ç‹€æ…‹ï¼šä½¿ç”¨ä¸­
```

#### 2.2 æª¢æŸ¥è©¦ç®—è¡¨ ID

åœ¨ `google_apps_script.js` ç¬¬ 199 è¡Œï¼š

```javascript
const SPREADSHEET_ID = '1oS9zTU6DL_cCRnOI6A4ffAeXXn7fXkr6URxxMVprlG4';
```

ç¢ºèªé€™å€‹ ID èˆ‡æ‚¨çš„ Google Sheets ç¶²å€ä¸­çš„ ID ä¸€è‡´ï¼š
```
https://docs.google.com/spreadsheets/d/ã€é€™å€‹IDã€‘/edit
```

#### 2.3 æ¸¬è©¦ Apps Script

åœ¨ Apps Script ç·¨è¼¯å™¨ä¸­ï¼š

1. é¸æ“‡å‡½æ•¸ï¼š`testConnection`
2. é»æ“Š **åŸ·è¡Œ** â–¶ï¸
3. æŸ¥çœ‹åŸ·è¡Œè¨˜éŒ„

å¦‚æœæ²’æœ‰ `testConnection` å‡½æ•¸ï¼Œæ–°å¢ä¸€å€‹ï¼š

```javascript
function testConnection() {
  console.log('========== æ¸¬è©¦é€£æ¥ ==========');
  
  const SPREADSHEET_ID = '1oS9zTU6DL_cCRnOI6A4ffAeXXn7fXkr6URxxMVprlG4';
  const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
  const sheet = spreadsheet.getSheetByName('Form_Responses1');
  
  console.log('è©¦ç®—è¡¨åç¨±:', spreadsheet.getName());
  console.log('å·¥ä½œè¡¨åç¨±:', sheet.getName());
  console.log('æœ€å¾Œä¸€è¡Œ:', sheet.getLastRow());
  
  // æ¸¬è©¦å¯«å…¥
  const testData = [
    formatTimestamp(),
    'æ¸¬è©¦é¤è»Š',
    'æ¸¬è©¦é¡å‹',
    'æ¸¬è©¦å ´åœ°',
    formatDateForSheet(new Date().toISOString().split('T')[0]),
    'å·±æ’ç­',
    1000,
    'å°šæœªä»˜æ¬¾',
    'ç³»çµ±æ¸¬è©¦'
  ];
  
  const lastRow = sheet.getLastRow();
  sheet.getRange(lastRow + 1, 1, 1, 9).setValues([testData]);
  
  console.log('âœ… æ¸¬è©¦å¯«å…¥æˆåŠŸï¼');
  console.log('==============================');
  
  return {
    success: true,
    message: 'é€£æ¥æ¸¬è©¦æˆåŠŸ',
    lastRow: sheet.getLastRow()
  };
}
```

---

### æ­¥é©Ÿ 3ï¸âƒ£ï¼šæª¢æŸ¥å‰ç«¯è«‹æ±‚

#### 3.1 å•é¡Œï¼š`mode: 'no-cors'`

ç›®å‰å‰ç«¯ä½¿ç”¨äº† `no-cors` æ¨¡å¼ï¼Œé€™æœƒå°è‡´ï¼š
- âœ… è«‹æ±‚å¯ä»¥ç™¼é€
- âŒ ç„¡æ³•è®€å–å›æ‡‰
- âŒ ç„¡æ³•ç¢ºèªæ˜¯å¦æˆåŠŸ

**ä½ç½®ï¼š** `index.html` ç¬¬ 4705 è¡Œ

```javascript
const response = await fetch(GOOGLE_SHEETS_CONFIG.webAppUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(dataToSend),
  mode: 'no-cors' // â† é€™å€‹æœƒå°è‡´å•é¡Œ
});
```

---

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šé‡æ–°éƒ¨ç½² Google Apps Scriptï¼ˆæ¨è–¦ï¼‰

#### æ­¥é©Ÿï¼š

1. **é–‹å•Ÿ Apps Script ç·¨è¼¯å™¨**
   - Google Sheets â†’ æ“´å……åŠŸèƒ½ â†’ Apps Script

2. **å‰µå»ºæ–°çš„éƒ¨ç½²**
   - é»æ“Š **éƒ¨ç½²** â†’ **æ–°å¢éƒ¨ç½²ä½œæ¥­**
   - é¸æ“‡é¡å‹ï¼š**ç¶²é æ‡‰ç”¨ç¨‹å¼**

3. **é—œéµè¨­å®š**ï¼ˆéå¸¸é‡è¦ï¼‰ï¼š
   ```
   èªªæ˜ï¼šv3.1.1ï¼ˆæˆ–ä»»ä½•æ–°ç‰ˆæœ¬è™Ÿï¼‰
   åŸ·è¡Œèº«åˆ†ï¼šæˆ‘
   å…·æœ‰æ‡‰ç”¨ç¨‹å¼å­˜å–æ¬Šçš„ä½¿ç”¨è€…ï¼šæ‰€æœ‰äºº  â† é‡è¦ï¼
   ```

4. **éƒ¨ç½²ä¸¦è¤‡è£½æ–° URL**
   - é»æ“Šã€Œéƒ¨ç½²ã€
   - è¤‡è£½æ–°çš„ Web App URL

5. **æ›´æ–°å‰ç«¯ URL**
   - ç·¨è¼¯ `index.html` ç¬¬ 4153 è¡Œ
   - æ›¿æ›ç‚ºæ–°çš„ URL
   - å„²å­˜æª”æ¡ˆ

6. **æ¸…é™¤ç€è¦½å™¨å¿«å–**
   - Ctrl + Shift + Delete
   - æ¸…é™¤å¿«å–å’Œ Cookie
   - é‡æ–°æ•´ç†é é¢ï¼ˆCtrl + F5ï¼‰

---

### æ–¹æ¡ˆ Bï¼šä¿®æ”¹å‰ç«¯è«‹æ±‚æ¨¡å¼

#### ä¿®æ”¹ `index.html` ç¬¬ 4699-4706 è¡Œï¼š

**åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼š**
```javascript
const response = await fetch(GOOGLE_SHEETS_CONFIG.webAppUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(dataToSend),
  mode: 'no-cors'
});
```

**ä¿®æ”¹ç‚ºï¼š**
```javascript
const response = await fetch(GOOGLE_SHEETS_CONFIG.webAppUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'text/plain'  // â† æ”¹ç”¨ text/plain
  },
  body: JSON.stringify(dataToSend)
  // â† ç§»é™¤ mode: 'no-cors'
});

// æª¢æŸ¥å›æ‡‰
if (response.ok) {
  const result = await response.json();
  console.log('âœ… Google Sheets å›æ‡‰:', result);
  
  if (result.success) {
    return { success: true, message: result.message || 'å·²æäº¤åˆ°Google Sheets' };
  } else {
    throw new Error(result.message || 'æäº¤å¤±æ•—');
  }
} else {
  throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}
```

---

### æ–¹æ¡ˆ Cï¼šä½¿ç”¨ Google Form æ¨¡å¼ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœ POST è«‹æ±‚ä¸€ç›´æœ‰å•é¡Œï¼Œå¯ä»¥æ”¹ç”¨ GET è«‹æ±‚ï¼š

#### ä¿®æ”¹å¾Œç«¯ï¼ˆgoogle_apps_script.jsï¼‰ï¼š

åœ¨ `doGet(e)` å‡½æ•¸ä¸­æ·»åŠ ï¼š

```javascript
function doGet(e) {
  // æª¢æŸ¥æ˜¯å¦ç‚ºæ–°å¢é ç´„è«‹æ±‚
  if (e.parameter.action === 'add') {
    return addBookingFromGet(e.parameter);
  }
  
  // æª¢æŸ¥æ˜¯å¦æœ‰ç²å–æ•¸æ“šè«‹æ±‚
  if (e.parameter.action === 'getBookings') {
    return getAllBookings();
  }
  
  // æª¢æŸ¥æ˜¯å¦æœ‰ç²å–å·²é ç´„æ—¥æœŸè«‹æ±‚
  if (e.parameter.action === 'getBookedDates') {
    return getBookedDates();
  }
  
  // é è¨­å›æ‡‰
  return ContentService
    .createTextOutput(JSON.stringify({
      status: 'success',
      message: 'é¤è»Šæ’ç­å ±åç³»çµ±é‹è¡Œæ­£å¸¸',
      timestamp: formatTimestamp()
    }))
    .setMimeType(ContentService.MimeType.JSON);
}

function addBookingFromGet(params) {
  const data = {
    vendor: params.vendor,
    location: params.location,
    date: params.date,
    timeSlot: params.timeSlot || '14:00-20:00',
    foodType: params.foodType,
    fee: params.fee || '600',
    timestamp: formatTimestamp()
  };
  
  return addBookingToSheet(data);
}
```

#### ä¿®æ”¹å‰ç«¯ï¼ˆindex.htmlï¼‰ï¼š

```javascript
async function submitToGoogleSheets(formData) {
  try {
    // æ§‹å»º URL åƒæ•¸
    const params = new URLSearchParams({
      action: 'add',
      vendor: formData.vendor,
      location: formData.location,
      date: formData.date,
      timeSlot: formData.timeSlot || '14:00-20:00',
      foodType: formData.foodType,
      fee: formData.fee || '600'
    });
    
    const url = `${GOOGLE_SHEETS_CONFIG.webAppUrl}?${params.toString()}`;
    
    const response = await fetch(url, {
      method: 'GET'
    });
    
    if (response.ok) {
      const result = await response.json();
      return result;
    } else {
      throw new Error('æäº¤å¤±æ•—');
    }
    
  } catch (error) {
    console.error('æäº¤å¤±æ•—:', error);
    throw error;
  }
}
```

---

## ğŸ§ª æ¸¬è©¦æ–¹æ¡ˆ

### æ¸¬è©¦ 1ï¼šç›´æ¥è¨ªå• Web App URL

åœ¨ç€è¦½å™¨ä¸­è¨ªå•ï¼š
```
https://script.google.com/macros/s/AKfycbzSw1_5Ve7WIwzziUAwKKmu3tde8DzBOxRi7ghxzmGbn10M1EtGKJARIPwVVY35-zZp/exec
```

**é æœŸçµæœï¼š**
```json
{
  "status": "success",
  "message": "é¤è»Šæ’ç­å ±åç³»çµ±é‹è¡Œæ­£å¸¸",
  "timestamp": "2025-10-11 12:34:56"
}
```

å¦‚æœé¡¯ç¤º 404 æˆ–å…¶ä»–éŒ¯èª¤ï¼Œè¡¨ç¤ºéƒ¨ç½²æœ‰å•é¡Œã€‚

---

### æ¸¬è©¦ 2ï¼šä½¿ç”¨ Postman æˆ– cURL æ¸¬è©¦

#### cURL å‘½ä»¤ï¼š

```bash
curl -X POST \
  'https://script.google.com/macros/s/AKfycbzSw1_5Ve7WIwzziUAwKKmu3tde8DzBOxRi7ghxzmGbn10M1EtGKJARIPwVVY35-zZp/exec' \
  -H 'Content-Type: application/json' \
  -d '{
    "vendor": "æ¸¬è©¦é¤è»Š",
    "location": "æ¼¢å ¡å¤§äº¨",
    "date": "2025-10-15",
    "timeSlot": "14:00-20:00",
    "foodType": "å°åƒè»Š",
    "fee": "1000"
  }'
```

#### Postman è¨­å®šï¼š

```
Method: POST
URL: https://script.google.com/.../exec
Headers:
  Content-Type: application/json
Body (raw JSON):
{
  "vendor": "æ¸¬è©¦é¤è»Š",
  "location": "æ¼¢å ¡å¤§äº¨",
  "date": "2025-10-15",
  "timeSlot": "14:00-20:00",
  "foodType": "å°åƒè»Š",
  "fee": "1000"
}
```

---

## ğŸ“‹ æœ€å¿«è§£æ±ºæ–¹æ¡ˆ

### âš¡ ç«‹å³åŸ·è¡Œï¼ˆ5åˆ†é˜è§£æ±ºï¼‰ï¼š

1. **é‡æ–°éƒ¨ç½² Apps Script**
   ```
   Apps Script ç·¨è¼¯å™¨ â†’ éƒ¨ç½² â†’ æ–°å¢éƒ¨ç½²ä½œæ¥­
   â†’ é¡å‹ï¼šç¶²é æ‡‰ç”¨ç¨‹å¼
   â†’ åŸ·è¡Œèº«åˆ†ï¼šæˆ‘
   â†’ å­˜å–æ¬Šï¼šæ‰€æœ‰äºº
   â†’ éƒ¨ç½²
   ```

2. **è¤‡è£½æ–° URL**

3. **æ›´æ–° index.html**
   ```javascript
   // ç¬¬ 4153 è¡Œ
   webAppUrl: 'æ–°çš„URL',
   ```

4. **æ¸…é™¤å¿«å–**
   ```
   Ctrl + Shift + Delete â†’ æ¸…é™¤æ‰€æœ‰
   ```

5. **æ¸¬è©¦**
   ```
   é‡æ–°æ•´ç†é é¢ â†’ æ–°å¢é ç´„ â†’ æª¢æŸ¥ Google Sheets
   ```

---

## ğŸ” è¨ºæ–·çµæœæª¢æŸ¥æ¸…å–®

å®Œæˆä»¥ä¸‹æª¢æŸ¥å¾Œï¼Œåœ¨ä¸‹æ–¹æ‰“å‹¾ï¼š

- [ ] âœ… Web App URL æ­£ç¢º
- [ ] âœ… è©¦ç®—è¡¨ ID æ­£ç¢º
- [ ] âœ… å·¥ä½œè¡¨åç¨±ç‚º `Form_Responses1`
- [ ] âœ… éƒ¨ç½²æ¬Šé™è¨­å®šç‚ºã€Œæ‰€æœ‰äººã€
- [ ] âœ… Apps Script `testConnection()` åŸ·è¡ŒæˆåŠŸ
- [ ] âœ… ç€è¦½å™¨æ§åˆ¶å°ç„¡éŒ¯èª¤
- [ ] âœ… ç›´æ¥è¨ªå• URL æœ‰å›æ‡‰
- [ ] âœ… æ¸…é™¤ç€è¦½å™¨å¿«å–
- [ ] âœ… æ¸¬è©¦é ç´„æˆåŠŸå¯«å…¥

---

## ğŸ’¡ å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±º

### éŒ¯èª¤ 1ï¼šã€ŒAuthorization requiredã€

**åŸå› ï¼š** Apps Script æ¬Šé™ä¸è¶³

**è§£æ±ºï¼š**
1. Apps Script â†’ åŸ·è¡Œ `initializeSheets`
2. æˆæ¬Šæ‡‰ç”¨ç¨‹å¼
3. é‡æ–°éƒ¨ç½²

---

### éŒ¯èª¤ 2ï¼šã€ŒScript function not foundã€

**åŸå› ï¼š** å‡½æ•¸åç¨±éŒ¯èª¤æˆ–æœªå„²å­˜

**è§£æ±ºï¼š**
1. ç¢ºèª `doPost` å‡½æ•¸å­˜åœ¨
2. é»æ“Š **å„²å­˜** ğŸ’¾
3. é‡æ–°éƒ¨ç½²

---

### éŒ¯èª¤ 3ï¼šã€ŒCannot read property of nullã€

**åŸå› ï¼š** æ‰¾ä¸åˆ°å·¥ä½œè¡¨

**è§£æ±ºï¼š**
1. ç¢ºèªå·¥ä½œè¡¨åç¨±ç‚º `Form_Responses1`
2. åŸ·è¡Œ `initializeSheets()` å»ºç«‹å·¥ä½œè¡¨
3. æª¢æŸ¥è©¦ç®—è¡¨ ID

---

### éŒ¯èª¤ 4ï¼šã€ŒCORS policy blockedã€

**åŸå› ï¼š** è·¨åŸŸè«‹æ±‚è¢«é˜»æ“‹

**è§£æ±ºï¼š**
- ä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆé‡æ–°éƒ¨ç½²ï¼‰
- æˆ–ä½¿ç”¨æ–¹æ¡ˆ Bï¼ˆä¿®æ”¹è«‹æ±‚ï¼‰

---

## ğŸ¯ ç¢ºèªä¿®å¾©æˆåŠŸ

å®Œæˆä¿®å¾©å¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹æ¸¬è©¦ï¼š

1. âœ… æ–°å¢ä¸€ç­†æ¸¬è©¦é ç´„
2. âœ… æª¢æŸ¥ Google Sheets æ˜¯å¦æœ‰æ–°è³‡æ–™
3. âœ… æª¢æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰æˆåŠŸè¨Šæ¯
4. âœ… æ¸¬è©¦æ¥æ‰‹é ç´„åŠŸèƒ½
5. âœ… æ¸¬è©¦è½‰è®“æ’ç­åŠŸèƒ½

---

<div align="center">

**ğŸ‰ å¦‚æœé‚„æ˜¯ç„¡æ³•è§£æ±ºï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š**

1. ç€è¦½å™¨æ§åˆ¶å°çš„å®Œæ•´éŒ¯èª¤è¨Šæ¯
2. Apps Script åŸ·è¡Œè¨˜éŒ„çš„æˆªåœ–
3. ç›´æ¥è¨ªå• Web App URL çš„å›æ‡‰

</div>

