# 🔒 防止「尚未付款」資料被隱藏

## 問題說明

當 Google Sheets 設定了篩選器，並且篩選條件隱藏了「尚未付款」的資料時，新增的預約會被自動隱藏，導致看起來像是沒有寫入。

---

## ✅ 已修復

### 修改內容

在 `google_apps_script.js` 中新增了自動顯示列的程式碼：

#### 1️⃣ 新增預約時（addBookingToSheet）

**位置：** 第 284-290 行

```javascript
// ✨ 確保新增的列不會被隱藏（重要！）
try {
  sheet.showRows(targetRow);
  console.log(`✅ 已確保第 ${targetRow} 行可見`);
} catch (showError) {
  console.warn('無法確保列可見:', showError);
}
```

#### 2️⃣ 接手預約時（takeoverBooking）

**位置：** 第 1335-1341 行

```javascript
// ✨ 確保該列不會被隱藏（接手後設為「尚未付款」）
try {
  sheet.showRows(rowNumber);
  console.log(`✅ 已確保第 ${rowNumber} 行可見`);
} catch (showError) {
  console.warn('無法確保列可見:', showError);
}
```

---

## 🎯 效果

### 修改前：
```
❌ 新增預約 → 資料寫入 → 被篩選器隱藏 → 看不到
```

### 修改後：
```
✅ 新增預約 → 資料寫入 → 自動顯示 → 立即可見
```

---

## 🔧 Google Sheets 端的建議設定

### 方案 A：調整篩選器（推薦）

1. **開啟 Google Sheets**

2. **點擊 H 欄（付款狀態）的篩選器圖標** 🔽

3. **確保所有選項都勾選**：
   ```
   ✅ 尚未付款
   ✅ 已付款
   ✅ 己繳款
   ✅ (空白)
   ```

4. **點擊「確定」**

### 方案 B：使用篩選檢視（進階）

如果您需要查看不同狀態的資料，建議使用「篩選檢視」而非「篩選器」：

1. **資料** → **篩選檢視** → **建立新的篩選檢視**

2. **命名篩選檢視**：
   - 「已付款」
   - 「尚未付款」
   - 「全部」

3. **設定篩選條件**

4. **在不同檢視間切換**

**優點：**
- ✅ 不會影響其他人的檢視
- ✅ 可以儲存多個篩選條件
- ✅ 新增的資料不會被隱藏

---

## 📝 如何確認資料已寫入

### 方法 1：檢查最後一行

1. 按 **Ctrl + ↓**（跳到最後一行）
2. 查看是否有新增的資料

### 方法 2：移除所有篩選

1. **資料** → **移除篩選器**
2. 檢查所有資料

### 方法 3：查看執行記錄

在 Apps Script 編輯器中：
1. 點擊 **執行作業**
2. 查看最近的執行記錄
3. 確認是否有成功訊息：
   ```
   ✅ 已確保第 X 行可見
   數據已成功插入到工作表
   ```

---

## 🧪 測試

### 測試步驟：

1. **在 Google Sheets 設定篩選器**
   - H 欄只顯示「已付款」
   - 隱藏「尚未付款」

2. **新增一筆測試預約**
   - 付款狀態會是「尚未付款」

3. **檢查 Google Sheets**
   - ✅ 新資料應該自動顯示
   - ✅ 不會被篩選器隱藏

4. **查看執行記錄**
   - 應該看到：`✅ 已確保第 X 行可見`

---

## ⚙️ 更新 Apps Script

### 步驟：

1. **開啟 Google Sheets** → 擴充功能 → Apps Script

2. **複製更新後的 `google_apps_script.js`**

3. **貼上到編輯器**

4. **點擊 **儲存** 💾**

5. **重新部署**（選擇性）
   - 如果要更新 Web App URL
   - 部署 → 管理部署作業 → 編輯 → 版本：新版本

6. **測試**
   - 新增一筆預約
   - 確認顯示正常

---

## 💡 進階功能

### 批次顯示所有隱藏列

如果有多筆資料被隱藏，可以在 Apps Script 中執行：

```javascript
function showAllHiddenRows() {
  const SPREADSHEET_ID = '1oS9zTU6DL_cCRnOI6A4ffAeXXn7fXkr6URxxMVprlG4';
  const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
  const sheet = spreadsheet.getSheetByName('Form_Responses1');
  
  const lastRow = sheet.getLastRow();
  
  // 顯示所有列
  sheet.showRows(1, lastRow);
  
  console.log(`✅ 已顯示全部 ${lastRow} 行`);
}
```

**執行：**
1. Apps Script 編輯器
2. 選擇函數：`showAllHiddenRows`
3. 點擊 **執行** ▶️

---

## 📊 監控

### 如何確認功能正常運作

查看 Apps Script 執行記錄：

```
========== 新增預約 ==========
工作表最後一行: 25，新資料將插入到第 26 行
數據已成功插入到工作表
✅ 已確保第 26 行可見  ← 這行表示成功
F26 欄位已設定公式
✅ 已排序 26 行資料
================================
```

如果看到「✅ 已確保第 X 行可見」，表示功能正常運作。

---

## ❓ 常見問題

### Q1: 如果還是看不到新資料怎麼辦？

**A:** 嘗試以下步驟：

1. 重新整理頁面（F5）
2. 移除所有篩選器
3. 檢查是否有隱藏的列
4. 查看 Apps Script 執行記錄

### Q2: 會不會影響現有的篩選器？

**A:** 不會。`showRows()` 只是確保該列不被隱藏，不會更改篩選器設定。

### Q3: 對已付款的資料有影響嗎？

**A:** 沒有影響。程式碼只在新增和接手時執行，不影響其他資料。

### Q4: 可以針對特定付款狀態設定嗎？

**A:** 可以！例如只顯示「尚未付款」：

```javascript
// 只在「尚未付款」時顯示
if (rowData[7] === '尚未付款') {
  sheet.showRows(targetRow);
}
```

---

## 🎉 總結

✅ **自動防止新增資料被隱藏**  
✅ **不影響現有篩選器設定**  
✅ **適用於新增和接手預約**  
✅ **執行記錄可追蹤**

---

<div align="center">

**現在可以放心使用篩選器，不用擔心新資料被隱藏了！** 🎊

[返回主文檔](README.md)

</div>

