# 🔧 解決 Google Sheets 隱藏行問題

---

## 🎯 問題說明

**問題**：新增「尚未付款」的資料後，經過自動排序可能會被移到隱藏的行中，導致看不到。

**原因**：系統會自動按日期排序，排序後新資料可能跑到中間的隱藏行。

**解決方案**：修改 Google Apps Script，確保所有「尚未付款」的行**永遠不會被隱藏**。

---

## ✅ 已修改內容

### 修改的文件

```
📄 google_apps_script.js
```

### 新增的功能

在 `quickSortSheet` 和 `sortSheetByDate` 函數中，**排序完成後**會自動執行：

```javascript
// ✨ 排序後，確保所有「尚未付款」的行都可見（防止被隱藏）
try {
  let unpaidCount = 0;
  for (let i = 0; i < sortedData.length; i++) {
    const rowIndex = i + 2; // 實際行號（從第2行開始）
    const paymentStatus = sortedData[i][7]; // H欄是款項結清狀態
    
    // 如果是「尚未付款」，確保該行可見
    if (paymentStatus === '尚未付款') {
      sheet.showRows(rowIndex);
      unpaidCount++;
    }
  }
  
  if (unpaidCount > 0) {
    console.log(`✅ 已確保 ${unpaidCount} 行「尚未付款」資料可見`);
  }
} catch (showError) {
  console.warn('顯示未付款行時發生錯誤:', showError);
}
```

---

## 🚀 如何更新

### 步驟1：打開 Google Apps Script

1. 打開您的 Google Sheets
2. 點擊 **擴充功能** → **Apps Script**
3. 會開啟腳本編輯器

### 步驟2：更新代碼

1. **複製修改後的代碼**：
   - 打開 `餐車老闆報班表\v1.0\google_apps_script.js`
   - 全選複製（Ctrl+A, Ctrl+C）

2. **貼上到 Google Apps Script**：
   - 在 Apps Script 編輯器中全選（Ctrl+A）
   - 貼上（Ctrl+V）

3. **儲存**：
   - 點擊 💾 儲存圖示
   - 或按 Ctrl+S

### 步驟3：部署

不需要重新部署！更新會自動生效。

---

## ✨ 效果

### 更新前

```
新增資料 → 排序 → 可能跑到隱藏行 → 看不到 ❌
```

### 更新後

```
新增資料 → 排序 → 自動顯示「尚未付款」行 → 一定看得到 ✅
```

---

## 🔍 運作邏輯

### 1. 新增資料時

- 插入到最後一行
- **立即確保該行可見**（第286-290行）

### 2. 自動排序後

- 按日期重新排列
- **檢查所有行的付款狀態**
- **如果是「尚未付款」→ 自動顯示該行**
- 已付款或其他狀態 → 維持原本的隱藏狀態

### 3. 保護機制

```
✅ 不影響已隱藏的「己繳款」或「已付款」資料
✅ 只顯示「尚未付款」的行
✅ 排序功能正常運作
✅ 其他隱藏行維持隱藏
```

---

## 💡 額外建議

### 建議1：使用篩選器代替隱藏

**更好的方式**：使用 Google Sheets 的**篩選功能**

```
優點：
✅ 可以隨時切換顯示/隱藏
✅ 不會影響新資料
✅ 更直觀易用
```

**設定方式**：
1. 選取標題行（第7行）
2. 點擊 **資料** → **建立篩選器**
3. 點擊 H欄（款項結清）的下拉選單
4. 勾選要顯示的狀態（如：只顯示「尚未付款」）

### 建議2：使用不同工作表

```
建議結構：
├── Form_Responses1 - 所有資料（包含已付款）
├── 待付款 - 只顯示尚未付款（用公式自動篩選）
└── 已完成 - 只顯示已付款（用公式自動篩選）
```

---

## 🧪 測試方法

### 測試步驟

1. **隱藏一些「己繳款」的行**
2. **新增一筆「尚未付款」的預約**
3. **檢查新資料是否可見**

**預期結果**：
- ✅ 新增的「尚未付款」資料一定可見
- ✅ 原本隱藏的「己繳款」資料維持隱藏
- ✅ 按日期自動排序

---

## ❓ 常見問題

### Q1：我手動隱藏了某行，還會被自動顯示嗎？

**A**：只有「尚未付款」的行會被自動顯示，其他狀態不受影響。

### Q2：我想隱藏某筆「尚未付款」的資料可以嗎？

**A**：可以手動隱藏，但下次有新資料排序時，會再次被顯示。
建議：把付款狀態改為「暫停」或其他，就不會被自動顯示。

### Q3：已付款的資料可以隱藏嗎？

**A**：可以！已付款的資料不會被自動顯示，您可以隨意隱藏或顯示。

---

## 📞 需要協助

如有問題：
- 查看「防止資料被隱藏說明.md」
- 聯繫官方小幫手：https://lin.ee/BStZlfM

---

**修復完成日期**：2025-10-11  
**影響範圍**：Google Apps Script 排序邏輯  
**修改行數**：google_apps_script.js 第874-893行、965-984行

