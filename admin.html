<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- 安全標頭 -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' https://sqgrnowrcvspxhuudrqc.supabase.co;">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<title>餐車排班管理後台 v3.2.3</title>

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<!-- Supabase JS Library -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- 外部樣式表 -->
<link rel="stylesheet" href="admin.css">

</head>
<body>

<!-- 登入畫面 -->
<div id="loginModal" class="login-modal">
  <div class="login-content">
    <div class="login-header">
      <h2><i class="fas fa-shield-alt"></i> 後台管理登入</h2>
    </div>
    <div class="login-body">
      <div class="login-form">
        <label>
          <i class="fas fa-key"></i> 管理密碼
        </label>
        <input type="password" id="adminPassword" placeholder="請輸入管理密碼" autocomplete="off">
        <button onclick="handleLogin()" class="login-btn">
          <i class="fas fa-sign-in-alt"></i> 登入
        </button>
        <div id="loginError" class="error-message hidden"></div>
      </div>
    </div>
  </div>
</div>

<!-- 主內容區域 -->
<div id="mainAdminContent" class="hidden">
  
  <!-- 頂部導航欄 -->
  <header class="admin-header">
    <div class="header-content">
      <h1><i class="fas fa-tachometer-alt"></i> 餐車排班管理後台</h1>
      <div class="header-actions">
        <button onclick="refreshData()" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> 重新載入
        </button>
        <button onclick="logout()" class="btn btn-secondary">
          <i class="fas fa-sign-out-alt"></i> 登出
        </button>
      </div>
    </div>
  </header>

  <!-- 功能導航選項卡 -->
  <div class="admin-tabs">
    <button class="tab-btn active" onclick="switchTab('bookings')" data-tab="bookings">
      <i class="fas fa-calendar-check"></i> 預約管理
    </button>
    <button class="tab-btn" onclick="switchTab('locations')" data-tab="locations">
      <i class="fas fa-map-marker-alt"></i> 場地管理
    </button>
    <button class="tab-btn" onclick="switchTab('notices')" data-tab="notices">
      <i class="fas fa-exclamation-triangle"></i> 注意事項管理
    </button>
  </div>

  <!-- 預約管理標籤頁 -->
  <div id="tabBookings" class="tab-content active">

  <!-- 月份選擇器 -->
  <div class="month-selector-section">
    <div class="month-selector-header">
      <h3><i class="fas fa-calendar-alt"></i> 選擇月份</h3>
      <button onclick="selectCurrentMonth()" class="btn btn-sm btn-secondary">
        <i class="fas fa-calendar-day"></i> 本月
      </button>
    </div>
    <div class="month-grid" id="monthGrid">
      <!-- 月份按鈕將由 JavaScript 動態生成 -->
    </div>
  </div>

  <!-- 篩選和搜尋區域 -->
  <div class="filter-section">
    <div class="filter-grid">
      <div class="filter-item filter-item-full">
        <label><i class="fas fa-search"></i> 搜尋</label>
        <input type="text" id="searchInput" placeholder="搜尋餐車名稱、場地、日期..." oninput="debouncedFilterBookings()">
      </div>
      <div class="filter-item">
        <label><i class="fas fa-map-marker-alt"></i> 場地</label>
        <select id="locationFilter" onchange="filterBookings()">
          <option value="">全部場地</option>
          <option value="四維路59號">四維路59號</option>
          <option value="漢堡大亨">漢堡大亨</option>
          <option value="自由風">自由風</option>
          <option value="蔬蒔">蔬蒔</option>
          <option value="金正好吃">金正好吃</option>
        </select>
      </div>
      <div class="filter-item">
        <label><i class="fas fa-dollar-sign"></i> 付款狀態</label>
        <select id="paymentFilter" onchange="filterBookings()">
          <option value="">全部</option>
          <option value="己繳款">已付款</option>
          <option value="未繳款">未付款</option>
          <option value="逾繳可排">逾期可排</option>
        </select>
      </div>
    </div>
  </div>

  <!-- 統計資訊 -->
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon stat-primary">
        <i class="fas fa-calendar-check"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="totalBookings">0</div>
        <div class="stat-label">總預約數</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-success">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="paidBookings">0</div>
        <div class="stat-label">已付款</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-warning">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="unpaidBookings">0</div>
        <div class="stat-label">未付款</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon stat-danger">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="overdueBookings">0</div>
        <div class="stat-label">逾期可排</div>
      </div>
    </div>
  </div>

  <!-- 新預約快速操作區域 -->
  <div id="newBookingsSection" class="new-bookings-section hidden">
    <div class="section-header">
      <div>
        <h2><i class="fas fa-bell"></i> 新預約快速操作</h2>
        <p class="section-subtitle">最近 24 小時內新增的預約</p>
      </div>
      <div class="section-actions">
        <span id="newBookingsCount" class="new-bookings-badge">0 筆新預約</span>
        <button onclick="markAllNewBookingsAsProcessed()" class="btn btn-sm btn-primary">
          <i class="fas fa-check-double"></i> 全部標記為已處理
        </button>
        <button onclick="toggleNewBookingsSection()" class="btn btn-sm btn-secondary" id="toggleNewBookingsBtn">
          <i class="fas fa-chevron-up"></i> 收起
        </button>
      </div>
    </div>
    
    <div class="new-bookings-grid" id="newBookingsGrid">
      <!-- 新預約卡片將由 JavaScript 動態生成 -->
    </div>
    
    <div id="noNewBookings" class="no-new-bookings hidden">
      <i class="fas fa-check-circle"></i>
      <p>目前沒有新的預約</p>
    </div>
  </div>

  <!-- 預約列表 -->
  <div class="bookings-section">
    <div class="section-header">
      <div>
        <h2><i class="fas fa-list"></i> 預約列表</h2>
        <p class="section-subtitle" id="currentMonthDisplay">載入中...</p>
      </div>
      <div class="section-actions">
        <button onclick="showProcessedBookingsModal()" class="btn btn-secondary btn-sm" id="viewProcessedBtn" title="查看已處理的預約">
          <i class="fas fa-eye"></i> 查看已處理
        </button>
        <div class="view-toggle">
          <button onclick="switchView('list')" class="view-btn active" id="listViewBtn" title="列表模式">
            <i class="fas fa-list"></i> 列表
          </button>
          <button onclick="switchView('calendar')" class="view-btn" id="calendarViewBtn" title="月曆模式">
            <i class="fas fa-calendar-alt"></i> 月曆
          </button>
        </div>
        <span id="bookingCount" class="booking-count">共 0 筆</span>
      </div>
    </div>
    
    <!-- 列表視圖 -->
    <div id="listView" class="view-container active">
      <div class="bookings-table-container">
        <table class="bookings-table">
          <thead>
            <tr>
              <th class="col-timestamp">時間</th>
              <th class="col-vendor">餐車名稱</th>
              <th class="col-type">類型</th>
              <th class="col-location">場地</th>
              <th class="col-date">日期</th>
              <th class="col-status">狀態</th>
              <th class="col-fee">費用</th>
              <th class="col-payment">付款</th>
              <th class="col-note">備註</th>
              <th class="col-actions">操作</th>
            </tr>
          </thead>
          <tbody id="bookingsTableBody">
            <tr>
              <td colspan="10" class="loading-row">
                <i class="fas fa-spinner fa-spin"></i> 載入中...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- 月曆視圖 -->
    <div id="calendarView" class="view-container">
      <div class="admin-calendar-container">
        <div class="admin-calendar-header">
          <button onclick="adminCalendarPrevMonth()" class="calendar-nav-btn" title="上一個月">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h3 id="adminCalendarMonthTitle" class="calendar-month-title">2025年1月</h3>
          <button onclick="adminCalendarNextMonth()" class="calendar-nav-btn" title="下一個月">
            <i class="fas fa-chevron-right"></i>
          </button>
          <button onclick="adminCalendarToday()" class="calendar-today-btn">
            <i class="fas fa-calendar-day"></i> 今天
          </button>
        </div>
        <div class="admin-calendar-grid" id="adminCalendarGrid">
          <!-- 月曆將由 JavaScript 動態生成 -->
        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- 預約管理標籤頁結束 -->

  <!-- 場地管理標籤頁 -->
  <div id="tabLocations" class="tab-content">
    <div class="locations-section">
      <div class="section-header">
        <div>
          <h2><i class="fas fa-map-marker-alt"></i> 場地管理</h2>
          <p class="section-subtitle">管理前端場地配置、開放日期和注意事項</p>
        </div>
        <div class="section-actions">
          <button onclick="loadLocations()" class="btn btn-secondary">
            <i class="fas fa-sync-alt"></i> 重新載入
          </button>
          <button onclick="showAddLocationModal()" class="btn btn-primary">
            <i class="fas fa-plus"></i> 新增場地
          </button>
        </div>
      </div>
      
      <div id="locationsList" class="locations-grid">
        <div class="loading-row">
          <i class="fas fa-spinner fa-spin"></i> 載入中...
        </div>
      </div>
    </div>
  </div>
  <!-- 場地管理標籤頁結束 -->

  <!-- 注意事項管理標籤頁 -->
  <div id="tabNotices" class="tab-content">
    <div class="notices-section">
      <div class="section-header">
        <div>
          <h2><i class="fas fa-exclamation-triangle"></i> 前端注意事項管理</h2>
          <p class="section-subtitle">管理前端顯示的重要注意事項</p>
        </div>
        <div class="section-actions">
          <button onclick="loadNotices()" class="btn btn-secondary">
            <i class="fas fa-sync-alt"></i> 重新載入
          </button>
          <button onclick="showAddNoticeModal()" class="btn btn-primary">
            <i class="fas fa-plus"></i> 新增注意事項
          </button>
        </div>
      </div>
      
      <!-- 篩選和搜尋區域 -->
      <div class="filter-section">
        <div class="filter-grid">
          <div class="filter-item filter-item-full">
            <label><i class="fas fa-search"></i> 搜尋</label>
            <input type="text" id="noticeSearchInput" placeholder="搜尋標題、內容、識別碼..." oninput="debouncedFilterNotices()">
          </div>
          <div class="filter-item">
            <label><i class="fas fa-tag"></i> 類型</label>
            <select id="noticeTypeFilter" onchange="filterNotices()">
              <option value="">全部類型</option>
              <option value="general">一般</option>
              <option value="warning">警告</option>
              <option value="info">資訊</option>
              <option value="success">成功</option>
            </select>
          </div>
          <div class="filter-item">
            <label><i class="fas fa-toggle-on"></i> 狀態</label>
            <select id="noticeStatusFilter" onchange="filterNotices()">
              <option value="">全部狀態</option>
              <option value="enabled">啟用中</option>
              <option value="disabled">已停用</option>
            </select>
          </div>
          <div class="filter-item">
            <label><i class="fas fa-map-marker-alt"></i> 場地</label>
            <select id="noticeLocationFilter" onchange="filterNotices()">
              <option value="">全部場地</option>
              <option value="通用">通用（所有場地）</option>
              <option value="四維路59號">四維路59號</option>
              <option value="漢堡大亨">漢堡大亨</option>
              <option value="自由風">自由風</option>
              <option value="蔬蒔">蔬蒔</option>
              <option value="金正好吃">金正好吃</option>
            </select>
          </div>
        </div>
      </div>
      
      <div id="noticesList" class="notices-list">
        <div class="loading-row">
          <i class="fas fa-spinner fa-spin"></i> 載入中...
        </div>
      </div>
    </div>
  </div>
  <!-- 注意事項管理標籤頁結束 -->

</div>

<!-- 刪除預約確認彈窗 -->
<div id="deleteConfirmModal" class="modal">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3><i class="fas fa-exclamation-triangle"></i> 確認刪除預約</h3>
      <span class="modal-close" onclick="closeDeleteConfirmModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="modal-confirm-warning danger">
        <div class="modal-confirm-warning-content">
          <i class="fas fa-exclamation-triangle"></i>
          <div class="modal-confirm-warning-text">
            <div class="modal-confirm-warning-label">警告</div>
            <div class="modal-confirm-warning-value">此操作無法復原！</div>
          </div>
        </div>
      </div>
      
      <div class="modal-confirm-info danger">
        <h4>
          <i class="fas fa-info-circle"></i>
          預約資訊
        </h4>
        <div class="modal-confirm-info-grid">
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">餐車名稱：</span>
            <span class="modal-confirm-info-value" id="deleteConfirmVendor">-</span>
          </div>
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">場地：</span>
            <span class="modal-confirm-info-value" id="deleteConfirmLocation">-</span>
          </div>
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">日期：</span>
            <span class="modal-confirm-info-value" id="deleteConfirmDate">-</span>
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="button" onclick="closeDeleteConfirmModal()" class="btn btn-secondary">
          <i class="fas fa-times"></i> 取消
        </button>
        <button type="button" id="confirmDeleteBtn" class="btn btn-danger">
          <i class="fas fa-trash"></i> 確認刪除
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 付款狀態變更確認彈窗 -->
<div id="paymentConfirmModal" class="modal">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3><i class="fas fa-exclamation-circle"></i> 確認變更付款狀態</h3>
      <span class="modal-close" onclick="closePaymentConfirmModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="modal-confirm-info">
        <h4>
          <i class="fas fa-info-circle"></i>
          預約資訊
        </h4>
        <div class="modal-confirm-info-grid">
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">餐車名稱：</span>
            <span class="modal-confirm-info-value" id="confirmVendor">-</span>
          </div>
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">場地：</span>
            <span class="modal-confirm-info-value" id="confirmLocation">-</span>
          </div>
          <div class="modal-confirm-info-item">
            <span class="modal-confirm-info-label">日期：</span>
            <span class="modal-confirm-info-value" id="confirmDate">-</span>
          </div>
        </div>
      </div>
      
      <div class="modal-confirm-warning">
        <div class="modal-confirm-warning-content">
          <i class="fas fa-exchange-alt"></i>
          <div class="modal-confirm-warning-text">
            <div class="modal-confirm-warning-label">付款狀態變更</div>
            <div class="modal-confirm-status-change">
              <div class="modal-confirm-status-item">
                <div class="modal-confirm-warning-label">目前狀態</div>
                <div class="modal-confirm-warning-value" id="confirmCurrentPayment">-</div>
              </div>
              <i class="fas fa-arrow-right modal-confirm-arrow"></i>
              <div class="modal-confirm-status-item">
                <div class="modal-confirm-warning-label">變更為</div>
                <div class="modal-confirm-warning-value" id="confirmNewPayment">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="button" onclick="closePaymentConfirmModal()" class="btn btn-secondary">
          <i class="fas fa-times"></i> 取消
        </button>
        <button type="button" id="confirmPaymentBtn" class="btn btn-primary">
          <i class="fas fa-check"></i> 確認變更
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 編輯預約彈窗 -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> 編輯預約</h3>
      <span class="modal-close" onclick="closeEditModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="editForm" onsubmit="saveBooking(event)">
        <input type="hidden" id="editRowNumber">
        
        <div class="form-group">
          <label><i class="fas fa-store"></i> 餐車名稱 <span class="required">*</span></label>
          <input type="text" id="editVendor" required>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-utensils"></i> 餐車類型</label>
          <select id="editFoodType">
            <option value="">請選擇</option>
            <option value="主食類">主食類</option>
            <option value="甜點類">甜點類</option>
            <option value="小點類">小點類</option>
            <option value="中式餐點">中式餐點</option>
            <option value="烤腿套餐">烤腿套餐</option>
            <option value="甜品類">甜品類</option>
            <option value="小吃類型">小吃類型</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-map-marker-alt"></i> 場地 <span class="required">*</span></label>
          <select id="editLocation" required>
            <option value="">請選擇場地</option>
            <option value="四維路59號">四維路59號</option>
            <option value="漢堡大亨">漢堡大亨 - 四維路70號</option>
            <option value="自由風">自由風 - 四維路190號</option>
            <option value="蔬蒔">蔬蒔 - 四維路216號</option>
            <option value="金正好吃">金正好吃 - 四維路218號</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-calendar"></i> 日期 <span class="required">*</span></label>
          <input type="date" id="editDate" required>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-check-circle"></i> 狀態</label>
          <select id="editStatus">
            <option value="己排">己排</option>
            <option value="未排">未排</option>
            <option value="取消">取消</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-dollar-sign"></i> 場地費</label>
          <input type="text" id="editFee" value="600元/天">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-credit-card"></i> 付款狀態</label>
          <select id="editPayment">
            <option value="未繳款">未繳款</option>
            <option value="己繳款">己繳款</option>
            <option value="逾繳可排">逾繳可排</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-sticky-note"></i> 備註</label>
          <textarea id="editNote" rows="3" placeholder="備註資訊..."></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" onclick="closeEditModal()" class="btn btn-secondary">
            <i class="fas fa-times"></i> 取消
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> 儲存
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 新增/編輯場地彈窗 -->
<div id="locationModal" class="modal">
  <div class="modal-content modal-md">
    <div class="modal-header">
      <h3><i class="fas fa-map-marker-alt"></i> <span id="locationModalTitle">新增場地</span></h3>
      <span class="modal-close" onclick="closeLocationModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="locationForm" onsubmit="saveLocation(event)">
        <input type="hidden" id="locationId">
        
        <div class="form-group">
          <label><i class="fas fa-key"></i> 場地識別碼 <span class="required">*</span></label>
          <input type="text" id="locationKey" required placeholder="例如：四維路59號" pattern="[^/]+" title="不能包含斜線">
          <small class="form-hint">唯一識別碼，用於前端顯示（不能包含斜線）</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-tag"></i> 顯示名稱 <span class="required">*</span></label>
          <input type="text" id="locationName" required placeholder="例如：楊梅區四維路59號">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-map-pin"></i> 完整地址 <span class="required">*</span></label>
          <input type="text" id="locationAddress" required placeholder="例如：桃園市楊梅區四維路59號">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-building"></i> 場地類型</label>
          <select id="locationType">
            <option value="戶外場地">戶外場地</option>
            <option value="店面場地">店面場地</option>
            <option value="美食廣場">美食廣場</option>
            <option value="健康蔬食">健康蔬食</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-toggle-on"></i> 啟用狀態</label>
          <label class="switch">
            <input type="checkbox" id="locationEnabled" checked>
            <span class="slider"></span>
          </label>
          <small class="form-hint">關閉後，前端將無法選擇此場地</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-calendar-week"></i> 可預約星期</label>
          <div class="weekday-selector">
            <label><input type="checkbox" value="0" class="weekday-checkbox"> 日</label>
            <label><input type="checkbox" value="1" class="weekday-checkbox" checked> 一</label>
            <label><input type="checkbox" value="2" class="weekday-checkbox" checked> 二</label>
            <label><input type="checkbox" value="3" class="weekday-checkbox" checked> 三</label>
            <label><input type="checkbox" value="4" class="weekday-checkbox" checked> 四</label>
            <label><input type="checkbox" value="5" class="weekday-checkbox" checked> 五</label>
            <label><input type="checkbox" value="6" class="weekday-checkbox" checked> 六</label>
          </div>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-clock"></i> 可用時段</label>
          <input type="text" id="locationTimeSlots" placeholder="例如：14:00-20:00" value="14:00-20:00">
          <small class="form-hint">多個時段用逗號分隔</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-dollar-sign"></i> 場地費用</label>
          <input type="text" id="locationFee" placeholder="例如：600元/天" value="600元/天">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-info-circle"></i> 場地限制</label>
          <textarea id="locationLimit" rows="2" placeholder="例如：僅限1車，不要跟店面強碰商品"></textarea>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-ban"></i> 禁止事項</label>
          <textarea id="locationBan" rows="2" placeholder="例如：飲料車、素食"></textarea>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-star"></i> 特殊說明</label>
          <textarea id="locationSpecial" rows="2" placeholder="例如：該場地週一~週三營業，國定假日休息"></textarea>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-exclamation-triangle"></i> 注意事項（每行一條）</label>
          <textarea id="locationNotices" rows="4" placeholder="例如：&#10;不供水、不供電，需自行清潔環境及垃圾處理&#10;僅限1車，請勿與店面商品強碰"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" onclick="closeLocationModal()" class="btn btn-secondary">
            <i class="fas fa-times"></i> 取消
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> 儲存
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 新增/編輯注意事項彈窗 -->
<div id="noticeModal" class="modal">
  <div class="modal-content modal-md">
    <div class="modal-header">
      <h3><i class="fas fa-exclamation-triangle"></i> <span id="noticeModalTitle">新增注意事項</span></h3>
      <span class="modal-close" onclick="closeNoticeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="noticeForm" onsubmit="saveNotice(event)">
        <input type="hidden" id="noticeId">
        
        <div class="form-group">
          <label><i class="fas fa-key"></i> 識別碼 <span class="required">*</span></label>
          <input type="text" id="noticeKey" required placeholder="例如：general-warning-001" pattern="[a-z0-9-]+" title="只能包含小寫字母、數字和連字號">
          <small class="form-hint">唯一識別碼（只能包含小寫字母、數字和連字號）</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-heading"></i> 標題 <span class="required">*</span></label>
          <input type="text" id="noticeTitle" required placeholder="例如：重要提醒">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-align-left"></i> 內容 <span class="required">*</span></label>
          <textarea id="noticeContent" rows="5" required placeholder="輸入注意事項內容..."></textarea>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-tag"></i> 類型</label>
          <select id="noticeType">
            <option value="general">一般</option>
            <option value="warning">警告</option>
            <option value="info">資訊</option>
            <option value="success">成功</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-map-marker-alt"></i> 針對場地</label>
          <select id="noticeTargetLocation">
            <option value="">通用（所有場地）</option>
            <option value="四維路59號">四維路59號</option>
            <option value="漢堡大亨">漢堡大亨</option>
            <option value="自由風">自由風</option>
            <option value="蔬蒔">蔬蒔</option>
            <option value="金正好吃">金正好吃</option>
          </select>
          <small class="form-hint">留空表示適用於所有場地</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-sort-numeric-down"></i> 顯示順序</label>
          <input type="number" id="noticeOrder" value="0" min="0">
          <small class="form-hint">數字越小越靠前顯示</small>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-toggle-on"></i> 啟用狀態</label>
          <label class="switch">
            <input type="checkbox" id="noticeEnabled" checked>
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="form-actions">
          <button type="button" onclick="closeNoticeModal()" class="btn btn-secondary">
            <i class="fas fa-times"></i> 取消
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> 儲存
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 匯款圖片放大模態框 -->
<div id="paymentImageModal" class="payment-image-modal">
  <span class="modal-close" onclick="closePaymentImageModal()">&times;</span>
  <img class="payment-image-modal-content" id="paymentImageModalImg" src="" alt="匯款證明">
</div>

<!-- 已處理預約查看模態框 -->
<div id="processedBookingsModal" class="modal">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3><i class="fas fa-eye"></i> 已處理的預約</h3>
      <span class="modal-close" onclick="closeProcessedBookingsModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="processedBookingsList">
        <div class="loading-row">
          <i class="fas fa-spinner fa-spin"></i> 載入中...
        </div>
      </div>
      <div class="form-actions processed-bookings-actions">
        <button onclick="clearAllProcessedBookings()" class="btn btn-danger">
          <i class="fas fa-trash"></i> 清除所有已處理記錄
        </button>
        <button onclick="closeProcessedBookingsModal()" class="btn btn-secondary">
          <i class="fas fa-times"></i> 關閉
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast 通知 -->
<div class="toast-container" id="toastContainer"></div>

<!-- 載入指示器 -->
<div class="loading-overlay hidden" id="loadingOverlay">
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p id="loadingMessage">處理中...</p>
  </div>
</div>

<!-- JavaScript -->
<script src="admin.js"></script>

</body>
</html>
